<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <!-- importar css-->
    <title>Aplicacion SO</title>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
            'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
            sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #660F2C;
        }
        
        code {
            font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
            monospace;
        }
        
        .body{
            background: #fafafa10;
            backdrop-filter: blur(1rem);
        }


        .cont-modificar{
        height: 120px;
        }

        .contenedor{
        background-color: #FFD8DB;
        }
    </style>
</head>
<body>

    <div class="container-fluid mt-5 d-flex flex-column justify-content-center align-items-center">
        <div class="mt-3"></div>

        <div class="mt-5">
            <h1 class="text-white">Sistemas operativos I</h1>
        </div>

        <div class="container body w-25 p-3 h-50 mt-4 d-flex flex-column justify-content-center align-items-center">

            <form class="d-flex flex-column justify-content-center align-items-center" onsubmit="return validarCredenciales()">
                <div class="container mt-4">
                    <label for="username" class="text-light">Username</label>
                    <input id="username" name="username" class="form-control mt-3 h-75"/>
                </div>

                <div class="container mt-5">
                    <label for="password" class="text-light">Password</label>
                    <input type="password" id="password" name="password" class="form-control mt-3 h-75"/>
                </div>

                <button type="submit" name="loginButton" class="btn btn-primary mt-5 mb-4">Login</button>
            </form>

        </div>

        <div class="modal fade" tabindex="-1" id="exitoModal">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
                <div class="modal-content">

                    <div class="modal-header">
                        <h5 class="modal-title">Gestión de usuarios</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                        
                        <div class="container-fluid mb-2">
                            <!--CREAR-->
                            <div class="container contenedor">
                                <h3>Crear:</h3>
                                <div class="d-flex flex-row justify-content-evenly align-items-center mt-2">
                                    <div class="w-50">
                                        <input id="crearU" name="crearU" placeholder="Username" class="h-50 w-75"/>
                                    </div>
                                    
                                    <div class="w-50">
                                        <input type="password" id="crearP" name="crearP" placeholder="Password" class="h-50 w-75"/>
                                    </div>

                                    <button type="submit" name="crearButton" class="btn btn-primary">Crear</button>
                                    
                                </div>

                            </div>

                            <!--BUSCAR-->
                            <div class="container mt-5 contenedor">
                                <h3>Buscar:</h3>
                                <div class="d-flex flex-column align-items-center">
                                    <input id="buscaruser" name="buscaruser" class="form-control h-50 w-50 mb-3" placeholder="Nombre de usuario"/>
                                    <button type="submit" name="buscarbutton" class="btn btn-primary w-25">Buscar</button>
                                </div>
                            </div>

                            <!--MODIFICAR-->
                            <div class="container cont-modificar mt-3 contenedor">
                                <div class="d-flex flex-column justify-content-evenly align-items-center">
                                    <div class="d-flex flex-row justify-content-evenly w-100">
                                        <div class="w-50">
                                            <label for="modificarU">Username</label>
                                            <input id="modificarU" name="modificarU" class="form-control h-50 w-75 mb-3"/>
                                        </div>
                                        
                                        <div class="w-50">
                                            <label for="modificarP">Password</label>
                                            <input type="text" id="modificarP" name="modificarP" class="form-control h-50 w-75 mb-3"/>
                                        </div>
                                    </div>
                                    

                                    <div class="mt-2 d-flex flex-row justify-content-evenly w-100">
                                        <button type="submit" name="modificarbutton" class="btn btn-primary w-25">Modificar</button>
                                        <button type="submit" name="eliminarbutton" class="btn btn-primary w-25">Eliminar</button>
                                    </div>
                                    
                                </div>
                            </div>

                            
                            
                        </div>

                    </div>
                    
                    <div class="modal-footer d-flex justify-content-center">
                        <button type="button" class="btn btn-secondary w-50" data-bs-dismiss="modal">Cerrar</button>
                    </div>

                </div>
            </div>
        </div>

        <script>

            function enviarDatos() {
                var username = document.getElementById('crearU').value;
                var password = document.getElementById('crearP').value;

                // Verificar que los campos no estén vacíos
                if (username === '' || password === '') {
                    alert('Por favor, complete todos los campos.');
                    return;
                }

                // Objeto con datos a enviar
                var data = {
                    username: username,
                    password: password
                };

                // Configurar la solicitud
                fetch('/crear', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error en la solicitud');
                    }
                    return response.json();
                })
                .then(data => {
                    // Manejar la respuesta del servidor
                    alert(data.message)
                })
                .catch(error => {
                    // Manejar errores
                    alert('Error en la solicitud al servidor');
                    console.error('Error:', error);
                });

                document.getElementById('crearU').value = '';
                document.getElementById('crearP').value = '';
            }

            function modificarDatos() {
                var usernamebuscar = document.getElementById('buscaruser').value;
                var username = document.getElementById('modificarU').value;
                var password = document.getElementById('modificarP').value;

                // Verificar que haya un usuario en el input de buscar
                if (usernamebuscar === '') {
                    alert('Por favor, busque un usuario.');
                    return;
                }

                // Verificar que los campos no estén vacíos
                if (username === '' || password === '') {
                    alert('Por favor, complete todos los campos.');
                    return;
                }

                // Objeto con datos a enviar
                var data = {
                    buscaruser: usernamebuscar,
                    username: username,
                    password: password
                };

                // Configurar la solicitud
                fetch('/modificar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error en la solicitud');
                    }
                    return response.json();
                })
                .then(data => {
                    // Manejar la respuesta del servidor
                    alert(data.message)
                })
                .catch(error => {
                    // Manejar errores
                    alert('Error en la solicitud al servidor');
                    console.error('Error:', error);
                });

                document.getElementById('modificarU').value = '';
                document.getElementById('modificarP').value = '';
                document.getElementById('buscarbutton').value = '';
            }

            function eliminarDatos() {
                var username = document.getElementById('buscaruser').value;

                // Verificar que no ingrese una cadena vacia
                if (username === '') {
                    alert('Por favor, busque un usuario.');
                    return;
                }

                // Objeto con datos a enviar
                var data = {
                    username: username,
                };

                // Configurar la solicitud
                fetch('/eliminar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error en la solicitud');
                    }
                    return response.json();
                })
                .then(data => {
                    // Manejar la respuesta del servidor
                    console.log(data);
                    alert(data.message)
                })
                .catch(error => {
                    // Manejar errores
                    alert('Error en la solicitud al servidor');
                    console.error('Error:', error);
                });

                document.getElementById('modificarU').value = '';
                document.getElementById('modificarP').value = '';
            }

            function buscarDatos() {
                var username = document.getElementById('buscaruser').value;

                // Verificar que no ingrese una cadena vacia
                if (username === '') {
                    alert('Por favor, ingrese un nombre de usuario.');
                    return;
                }

                // Objeto con datos a enviar
                var data = {
                    username: username,
                };

                // Configurar la solicitud
                fetch('/buscar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error en la solicitud');
                    }
                    return response.json();
                })
                .then(data => {
                    // Manejar la respuesta del servidor
                    if (data) {
                        // Llenar los campos con los datos obtenidos
                        document.getElementById('modificarU').value = data.username;
                        document.getElementById('modificarP').value = data.password;
                        alert("Usuario encontrado");
                    } else {
                        alert('Usuario no encontradooo');
                        console.log(data.message);
                    }
                })
                .catch(error => {
                    // Manejar errores
                    alert('Error en la solicitud al servidor');
                    console.error('Error:', error);
                });
            }

            function validarCredenciales() {
                var username = document.getElementById('username').value;
                var password = document.getElementById('password').value;

                if (username === 'admin' && password === 'admin') {
                    // Inicio de sesión exitoso, abrir el modal
                    var myModal = new bootstrap.Modal(document.getElementById('exitoModal'), {
                        keyboard: false,
                        backdrop: 'static'
                    });
                    myModal.show();

                    return false; // Evita que el formulario se envíe
                } else {
                    // Credenciales incorrectas, redirigir a /login
                    // Crear un formulario dinámicamente
                    var form = document.createElement("form");
                    form.method = "post";
                    form.action = "/login";

                    // Agregar un campo de entrada para el nombre de usuario
                    var inputUsername = document.createElement("input");
                    inputUsername.type = "text";
                    inputUsername.name = "username";
                    inputUsername.value = document.getElementById('username').value; // Valor del nombre de usuario
                    form.appendChild(inputUsername);
                    console.log(inputUsername)

                    // Agregar un campo de entrada para la contraseña
                    var inputPassword = document.createElement("input");
                    inputPassword.type = "password";
                    inputPassword.name = "password";
                    inputPassword.value = document.getElementById('password').value; // Valor de la contraseña
                    form.appendChild(inputPassword);

                    // Agregar el formulario al documento y enviarlo
                    document.body.appendChild(form);
                    form.submit();

                    // Limpiar el formulario después de enviarlo
                    document.body.removeChild(form);

                    return false
                }
            }

            document.querySelector('[name="buscarbutton"]').addEventListener('click', function (event) {
                event.preventDefault();
                buscarDatos();
            });

            document.querySelector('[name="crearButton"]').addEventListener('click', function (event) {
                event.preventDefault();
                enviarDatos();
            });

            document.querySelector('[name="modificarbutton"]').addEventListener('click', function (event) {
                event.preventDefault();
                modificarDatos();
            });

            document.querySelector('[name="eliminarbutton"]').addEventListener('click', function (event) {
                event.preventDefault();
                eliminarDatos();
            });

        </script>

    </div>
    
</body>
</html>